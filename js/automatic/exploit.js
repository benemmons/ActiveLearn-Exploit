if(!window.contentScriptInjected){
    contentScriptInjected = true;
    console.log("Loaded content script")
    chrome.storage.onChanged.addListener(function(changes, namespace) {
        chrome.storage.sync.get("automaticState", function (automaticStateObject) {
            chrome.storage.sync.get("properties", function (propertiesObject) {
                automaticState = automaticStateObject.automaticState
                properties = propertiesObject.properties
                
                if (automaticState == "started"){
                    var loop;

                    var wait = properties.waitDuration * 1000;
                    var exploit = async function() {
                        wait = properties.waitDuration * 1000;
                        wait += 1000 * (Math.random() * (properties.randomness - -(properties.randomness)) + -(properties.randomness));

                        var iframe = document.getElementById("playerFrame");
                        var Main_Button = iframe.contentWindow.document.getElementById('checkAnswer')

                        function Click_Button(){Main_Button.click();}
                        function Change_Button_Label(New_Label){Main_Button.innerHTML = New_Label;}

                        Change_Button_Label('Show answers')
                        Click_Button()
                        Change_Button_Label('Check answers')
                        Click_Button()
                        Click_Button()
                        if (automaticState != "stopped"){
                            loop = setTimeout(exploit, wait);
                        }
                    }
                    loop = setTimeout(exploit, wait);
                }

            })
            
        })

    })
}

